<html>
  <head>
    <meta charset="UTF-8">
    <title>TESRT</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <button onclick = "getAccel()">Get Permission</button>
    <div id = "code">
      debug
      </div>
  </body>
  <script type = "module">
    import {FunctionImage} from "./FunctionImage.js"
    let func = new FunctionImage("myCanvas")
    document.body.appendChild(func)
    func.start()
    func.id = "test"
  </script>
  <script>
  let test = document.getElementById("test")
  let code = document.getElementById("code");
  function getAccel(){
      // feature detect
    code.innerHTML = "get Acc"
    if (typeof DeviceMotionEvent.requestPermission === 'function') {
      DeviceMotionEvent.requestPermission()
        .then(permissionState => {
            if (permissionState === 'granted') {
              window.addEventListener('deviceorientation',(event) => {
                code.innerHTML = "update"
                test.ax = 5+5*(1 + Math.sin(2*Math.PI*(event.alpha*2 + 180)/360));
                test.ay = (1.5 + Math.sin(2*Math.PI*(event.beta*2 + 180)/360))/2;
                test.az = 5+5*(1 + Math.sin(2*Math.PI*(event.gamma*2 + 180)/360));
                code.innerHTML = `alpha: ${event.alpha}, beta: ${event.beta}, gamma: ${event.gamma}`
            });
          }else{
            code.innerHTML = "Error permission denied"
          }
        })
        .catch(() =>{
          code.innerHTML = "Error on device motion permission request"
        });
    } else {
      // handle regular non iOS 13+ devices
    }
  }

  </script>


  <style>
  canvas{
    width: 100%;

  }
  </style>
</html>
