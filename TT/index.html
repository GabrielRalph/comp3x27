<html>
  <head>
    <meta charset="UTF-8">
    <title>TESRT</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <button onclick = "getAccel()">Get Permission</button>
    <div id = "code">
      debug
      </div>
  </body>
  <script type = "module">
    import {FunctionImage} from "./FunctionImage.js"
    let func = new FunctionImage("myCanvas")
    document.body.appendChild(func)
    func.start()
    func.id = "test"
  </script>
  <script>

  let code = document.getElementById("code");
  let test = document.getElementById("test")
  let update = (x, z, y) => {
    if (test instanceof Element){
      test.ax = x;
      test.az = z;
      test.ay = y;
    }else{
      test = document.getElementById("test")
    }
  }
  function getAccel(){
      // feature detect
    code.innerHTML = "get Acc"
    if (typeof DeviceMotionEvent.requestPermission === 'function') {
      DeviceMotionEvent.requestPermission()
        .then(permissionState => {
            if (permissionState === 'granted') {
              window.addEventListener('deviceorientation',(event) => {
                let alpha = (1 + Math.sin(2*Math.PI*(event.alpha*2 + 180)/360))/2;
                let gamma = (1 + Math.sin(2*Math.PI*(event.gamma*2 + 180)/360))/2;
                let beta = (1 + Math.sin(2*Math.PI*(event.beta*2 + 180)/360))/2;
                update(alpha, gamma, beta)
                code.innerHTML = `alpha: ${Math.round(alpha*360)}, beta: ${Math.round(beta*360)}, gamma: ${Math.round(gamma*360)}`
            });
          }else{
            code.innerHTML = "Error permission denied"
          }
        })
        .catch(() =>{
          code.innerHTML = "Error on device motion permission request"
        });
    } else {
      // handle regular non iOS 13+ devices
    }
  }


  </script>


  <style>
  canvas{
    width: 100%;

  }
  </style>
</html>
